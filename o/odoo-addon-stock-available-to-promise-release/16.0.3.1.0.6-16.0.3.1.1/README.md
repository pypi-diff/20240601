# Comparing `tmp/odoo_addon_stock_available_to_promise_release-16.0.3.1.0.6-py3-none-any.whl.zip` & `tmp/odoo_addon_stock_available_to_promise_release-16.0.3.1.1-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,53 +1,53 @@
-Zip file size: 88630 bytes, number of entries: 51
--rw-r--r--  2.0 unx     7108 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/README.rst
--rw-r--r--  2.0 unx       76 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/__init__.py
--rw-r--r--  2.0 unx      996 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/__manifest__.py
--rw-r--r--  2.0 unx      829 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/hooks.py
--rw-r--r--  2.0 unx    26676 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/i18n/es.po
--rw-r--r--  2.0 unx    25600 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/i18n/es_AR.po
--rw-r--r--  2.0 unx    23617 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/i18n/hr.po
--rw-r--r--  2.0 unx    26601 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/i18n/it.po
--rw-r--r--  2.0 unx    21778 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/i18n/stock_available_to_promise_release.pot
--rw-r--r--  2.0 unx      412 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/migrations/16.0.2.0.0/post-migrate.py
--rw-r--r--  2.0 unx      428 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/migrations/16.0.3.1.0/post-migrate.py
--rw-r--r--  2.0 unx      256 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/models/__init__.py
--rw-r--r--  2.0 unx     1085 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/models/product_product.py
--rw-r--r--  2.0 unx      805 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/models/res_company.py
--rw-r--r--  2.0 unx      520 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/models/res_config_settings.py
--rw-r--r--  2.0 unx      584 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/models/stock_location.py
--rw-r--r--  2.0 unx    28754 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/models/stock_move.py
--rw-r--r--  2.0 unx     7295 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/models/stock_picking.py
--rw-r--r--  2.0 unx     2904 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/models/stock_picking_type.py
--rw-r--r--  2.0 unx      788 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/models/stock_route.py
--rw-r--r--  2.0 unx     2901 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/models/stock_rule.py
--rw-r--r--  2.0 unx      240 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/readme/CONFIGURE.rst
--rw-r--r--  2.0 unx      264 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx       80 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/readme/CREDITS.rst
--rw-r--r--  2.0 unx     2253 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx     1435 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/readme/USAGE.rst
--rw-r--r--  2.0 unx      297 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/security/ir.model.access.csv
--rw-r--r--  2.0 unx     9455 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/static/description/icon.png
--rw-r--r--  2.0 unx    17584 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/static/description/index.html
--rw-r--r--  2.0 unx      174 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/tests/__init__.py
--rw-r--r--  2.0 unx     4669 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/tests/common.py
--rw-r--r--  2.0 unx    50969 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/tests/test_reservation.py
--rw-r--r--  2.0 unx     6417 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/tests/test_unrelease.py
--rw-r--r--  2.0 unx     3354 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/tests/test_unrelease_2steps.py
--rw-r--r--  2.0 unx     2842 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/tests/test_unrelease_3steps.py
--rw-r--r--  2.0 unx     2103 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/tests/test_unrelease_merged_moves.py
--rw-r--r--  2.0 unx     1206 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/views/product_product_views.xml
--rw-r--r--  2.0 unx     2787 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/views/res_config_settings.xml
--rw-r--r--  2.0 unx     4606 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/views/stock_move_views.xml
--rw-r--r--  2.0 unx     1908 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/views/stock_picking_type_views.xml
--rw-r--r--  2.0 unx     6677 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/views/stock_picking_views.xml
--rw-r--r--  2.0 unx      584 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/views/stock_route_views.xml
--rw-r--r--  2.0 unx       58 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/wizards/__init__.py
--rw-r--r--  2.0 unx      640 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/wizards/stock_release.py
--rw-r--r--  2.0 unx     1856 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/wizards/stock_release_views.xml
--rw-r--r--  2.0 unx      646 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/wizards/stock_unrelease.py
--rw-r--r--  2.0 unx     1888 b- defN 24-Apr-09 13:23 odoo/addons/stock_available_to_promise_release/wizards/stock_unrelease_views.xml
--rw-r--r--  2.0 unx     7737 b- defN 24-Apr-09 13:23 odoo_addon_stock_available_to_promise_release-16.0.3.1.0.6.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-Apr-09 13:23 odoo_addon_stock_available_to_promise_release-16.0.3.1.0.6.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 24-Apr-09 13:23 odoo_addon_stock_available_to_promise_release-16.0.3.1.0.6.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     6452 b- defN 24-Apr-09 13:23 odoo_addon_stock_available_to_promise_release-16.0.3.1.0.6.dist-info/RECORD
-51 files, 319291 bytes uncompressed, 77496 bytes compressed:  75.7%
+Zip file size: 88840 bytes, number of entries: 51
+-rw-r--r--  2.0 unx     7108 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/README.rst
+-rw-r--r--  2.0 unx       76 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/__init__.py
+-rw-r--r--  2.0 unx      996 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/__manifest__.py
+-rw-r--r--  2.0 unx      829 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/hooks.py
+-rw-r--r--  2.0 unx    26676 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/i18n/es.po
+-rw-r--r--  2.0 unx    25600 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/i18n/es_AR.po
+-rw-r--r--  2.0 unx    23617 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/i18n/hr.po
+-rw-r--r--  2.0 unx    26601 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/i18n/it.po
+-rw-r--r--  2.0 unx    21778 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/i18n/stock_available_to_promise_release.pot
+-rw-r--r--  2.0 unx      412 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/migrations/16.0.2.0.0/post-migrate.py
+-rw-r--r--  2.0 unx      428 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/migrations/16.0.3.1.0/post-migrate.py
+-rw-r--r--  2.0 unx      256 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/models/__init__.py
+-rw-r--r--  2.0 unx     1085 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/models/product_product.py
+-rw-r--r--  2.0 unx      805 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/models/res_company.py
+-rw-r--r--  2.0 unx      520 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/models/res_config_settings.py
+-rw-r--r--  2.0 unx      584 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/models/stock_location.py
+-rw-r--r--  2.0 unx    29563 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/models/stock_move.py
+-rw-r--r--  2.0 unx     7295 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/models/stock_picking.py
+-rw-r--r--  2.0 unx     2904 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/models/stock_picking_type.py
+-rw-r--r--  2.0 unx      788 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/models/stock_route.py
+-rw-r--r--  2.0 unx     2901 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/models/stock_rule.py
+-rw-r--r--  2.0 unx      240 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/readme/CONFIGURE.rst
+-rw-r--r--  2.0 unx      264 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx       80 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/readme/CREDITS.rst
+-rw-r--r--  2.0 unx     2253 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx     1435 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/readme/USAGE.rst
+-rw-r--r--  2.0 unx      297 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/security/ir.model.access.csv
+-rw-r--r--  2.0 unx     9455 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/static/description/icon.png
+-rw-r--r--  2.0 unx    17584 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/static/description/index.html
+-rw-r--r--  2.0 unx      174 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/tests/__init__.py
+-rw-r--r--  2.0 unx     4669 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/tests/common.py
+-rw-r--r--  2.0 unx    50969 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/tests/test_reservation.py
+-rw-r--r--  2.0 unx     7940 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/tests/test_unrelease.py
+-rw-r--r--  2.0 unx     3354 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/tests/test_unrelease_2steps.py
+-rw-r--r--  2.0 unx     2842 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/tests/test_unrelease_3steps.py
+-rw-r--r--  2.0 unx     2103 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/tests/test_unrelease_merged_moves.py
+-rw-r--r--  2.0 unx     1206 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/views/product_product_views.xml
+-rw-r--r--  2.0 unx     2787 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/views/res_config_settings.xml
+-rw-r--r--  2.0 unx     4606 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/views/stock_move_views.xml
+-rw-r--r--  2.0 unx     1908 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/views/stock_picking_type_views.xml
+-rw-r--r--  2.0 unx     6677 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/views/stock_picking_views.xml
+-rw-r--r--  2.0 unx      584 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/views/stock_route_views.xml
+-rw-r--r--  2.0 unx       58 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/wizards/__init__.py
+-rw-r--r--  2.0 unx      640 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/wizards/stock_release.py
+-rw-r--r--  2.0 unx     1856 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/wizards/stock_release_views.xml
+-rw-r--r--  2.0 unx      646 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/wizards/stock_unrelease.py
+-rw-r--r--  2.0 unx     1888 b- defN 24-Jun-01 11:09 odoo/addons/stock_available_to_promise_release/wizards/stock_unrelease_views.xml
+-rw-r--r--  2.0 unx     7735 b- defN 24-Jun-01 11:09 odoo_addon_stock_available_to_promise_release-16.0.3.1.1.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-Jun-01 11:09 odoo_addon_stock_available_to_promise_release-16.0.3.1.1.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 24-Jun-01 11:09 odoo_addon_stock_available_to_promise_release-16.0.3.1.1.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     6444 b- defN 24-Jun-01 11:09 odoo_addon_stock_available_to_promise_release-16.0.3.1.1.dist-info/RECORD
+51 files, 321613 bytes uncompressed, 77722 bytes compressed:  75.8%
```

## zipnote {}

```diff
@@ -135,20 +135,20 @@
 
 Filename: odoo/addons/stock_available_to_promise_release/wizards/stock_unrelease.py
 Comment: 
 
 Filename: odoo/addons/stock_available_to_promise_release/wizards/stock_unrelease_views.xml
 Comment: 
 
-Filename: odoo_addon_stock_available_to_promise_release-16.0.3.1.0.6.dist-info/METADATA
+Filename: odoo_addon_stock_available_to_promise_release-16.0.3.1.1.dist-info/METADATA
 Comment: 
 
-Filename: odoo_addon_stock_available_to_promise_release-16.0.3.1.0.6.dist-info/WHEEL
+Filename: odoo_addon_stock_available_to_promise_release-16.0.3.1.1.dist-info/WHEEL
 Comment: 
 
-Filename: odoo_addon_stock_available_to_promise_release-16.0.3.1.0.6.dist-info/top_level.txt
+Filename: odoo_addon_stock_available_to_promise_release-16.0.3.1.1.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo_addon_stock_available_to_promise_release-16.0.3.1.0.6.dist-info/RECORD
+Filename: odoo_addon_stock_available_to_promise_release-16.0.3.1.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/stock_available_to_promise_release/README.rst

```diff
@@ -3,15 +3,15 @@
 ==================================
 
 .. 
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    !! This file is generated by oca-gen-addon-readme !!
    !! changes will be overwritten.                   !!
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-   !! source digest: sha256:7136991a96008e33746c0da827e727e20643070177bcc9979d3dfab83001a3d2
+   !! source digest: sha256:60c2c80681ea342a123d5e58c8fc019dfb706c4c0e440b8f034ef92790efbc2d
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 
 .. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
     :target: https://odoo-community.org/page/development-status
     :alt: Beta
 .. |badge2| image:: https://img.shields.io/badge/licence-LGPL--3-blue.png
     :target: http://www.gnu.org/licenses/lgpl-3.0-standalone.html
```

## odoo/addons/stock_available_to_promise_release/__manifest__.py

```diff
@@ -1,13 +1,13 @@
 # Copyright 2019 Camptocamp (https://www.camptocamp.com)
 # License LGPL-3.0 or later (http://www.gnu.org/licenses/lgpl.html)
 
 {
     "name": "Stock Available to Promise Release",
-    "version": "16.0.3.1.0",
+    "version": "16.0.3.1.1",
     "summary": "Release Operations based on available to promise",
     "author": "Camptocamp, BCIM, Odoo Community Association (OCA)",
     "website": "https://github.com/OCA/wms",
     "category": "Stock Management",
     "depends": ["stock"],
     "data": [
         "security/ir.model.access.csv",
```

## odoo/addons/stock_available_to_promise_release/models/stock_move.py

```diff
@@ -49,15 +49,15 @@
     release_ready = fields.Boolean(
         compute="_compute_release_ready",
         search="_search_release_ready",
     )
     need_release = fields.Boolean(index=True, copy=False)
     unrelease_allowed = fields.Boolean(compute="_compute_unrelease_allowed")
 
-    @api.depends("rule_id", "rule_id.available_to_promise_defer_pull")
+    @api.depends("need_release", "rule_id", "rule_id.available_to_promise_defer_pull")
     def _compute_unrelease_allowed(self):
         for move in self:
             unrelease_allowed = move._is_unreleaseable()
             if unrelease_allowed:
                 iterator = move._get_chained_moves_iterator("move_orig_ids")
                 next(iterator)  # skip the current move
                 for origin_moves in iterator:
@@ -84,33 +84,54 @@
             and self.picking_type_id.code == "outgoing"
             and self.rule_id.available_to_promise_defer_pull
         )
 
     def _is_unrelease_allowed_on_origin_moves(self, origin_moves):
         """We check that the origin moves are in a state that allows the unrelease
         of the current move. At this stage, a move can't be unreleased if
-          * a picking is already printed. (The work on the picking is planed and
+          * a picking is already printed. (The work on the picking is planned and
             we don't want to change it)
-          * the processing of the origin moves is partially started.
+          * a quantity done is recorded
+          * the processed origin moves is not consumed by the dest moves.
         """
         self.ensure_one()
-        pickings = origin_moves.mapped("picking_id")
+        open_origin_moves = origin_moves.filtered(
+            lambda m: m.state not in ("done", "cancel")
+        )
+        pickings = open_origin_moves.mapped("picking_id")
         if pickings.filtered("printed"):
             # The picking is printed, we can't unrelease the move
             # because the processing of the origin moves is started.
             return False
-        origin_moves = origin_moves.filtered(
-            lambda m: m.state not in ("done", "cancel")
+        if any(m.quantity_done for m in open_origin_moves):
+            # The origin move is being processed, we can't unrelease the move
+            return False
+        origin_done_moves = origin_moves.filtered(lambda m: m.state == "done")
+        origin_qty_done = sum(
+            m.product_uom._compute_quantity(
+                m.quantity_done,
+                m.product_id.uom_id,
+                rounding_method="HALF-UP",
+            )
+            for m in origin_done_moves
+        )
+        dest_done_moves = origin_done_moves.move_dest_ids
+        dest_qty_done = sum(
+            m.product_uom._compute_quantity(
+                m.quantity_done,
+                m.product_id.uom_id,
+                rounding_method="HALF-UP",
+            )
+            for m in dest_done_moves
         )
-        origin_qty_todo = sum(origin_moves.mapped("product_qty"))
         return (
             float_compare(
-                self.product_qty,
-                origin_qty_todo,
-                precision_rounding=self.product_uom.rounding,
+                origin_qty_done,
+                dest_qty_done,
+                precision_rounding=self.product_id.uom_id.rounding,
             )
             <= 0
         )
 
     def _check_unrelease_allowed(self):
         for move in self:
             if not move.unrelease_allowed:
```

## odoo/addons/stock_available_to_promise_release/static/description/index.html

```diff
@@ -362,15 +362,15 @@
 <div class="document" id="stock-available-to-promise-release">
 <h1 class="title">Stock Available to Promise Release</h1>
 
 <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 !! This file is generated by oca-gen-addon-readme !!
 !! changes will be overwritten.                   !!
 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-!! source digest: sha256:7136991a96008e33746c0da827e727e20643070177bcc9979d3dfab83001a3d2
+!! source digest: sha256:60c2c80681ea342a123d5e58c8fc019dfb706c4c0e440b8f034ef92790efbc2d
 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
 <p><a class="reference external image-reference" href="https://odoo-community.org/page/development-status"><img alt="Beta" src="https://img.shields.io/badge/maturity-Beta-yellow.png" /></a> <a class="reference external image-reference" href="http://www.gnu.org/licenses/lgpl-3.0-standalone.html"><img alt="License: LGPL-3" src="https://img.shields.io/badge/licence-LGPL--3-blue.png" /></a> <a class="reference external image-reference" href="https://github.com/OCA/wms/tree/16.0/stock_available_to_promise_release"><img alt="OCA/wms" src="https://img.shields.io/badge/github-OCA%2Fwms-lightgray.png?logo=github" /></a> <a class="reference external image-reference" href="https://translation.odoo-community.org/projects/wms-16-0/wms-16-0-stock_available_to_promise_release"><img alt="Translate me on Weblate" src="https://img.shields.io/badge/weblate-Translate%20me-F47D42.png" /></a> <a class="reference external image-reference" href="https://runboat.odoo-community.org/builds?repo=OCA/wms&amp;target_branch=16.0"><img alt="Try me on Runboat" src="https://img.shields.io/badge/runboat-Try%20me-875A7B.png" /></a></p>
 <p>Currently the reservation is performed by adding reserved quantities on quants,
 which is fine as long as the reservation is made right after the order
 confirmation. This way, the first arrived, first served principle is always
 applied. But if you release warehouse operations in a chosen order (through
 deliver round for example), then you need to be sure the reservations are made
```

## odoo/addons/stock_available_to_promise_release/tests/test_unrelease.py

```diff
@@ -82,18 +82,18 @@
         self.assertEqual(self.picking.state, "done")
         self.assertFalse(self.shipping.move_ids.unrelease_allowed)
         with self.assertRaisesRegex(
             UserError, "You are not allowed to unrelease this move"
         ):
             self.shipping.move_ids.unrelease()
 
-    def test_unrelease_backorder(self):
-        """Check the unrelease of a shipping backorder move"""
-        # we do a partial pick and validate the picking to create a backorder
-        # a validation
+    def test_unrelease_backorder_when_remaining_picking(self):
+        """Check the unrelease of a shipping backorder move
+
+        The picking has been partially processed and a pick backorder has beeen created"""
         line = self.picking.move_ids.move_line_ids
         line.qty_done = line.reserved_qty - 1
         self.picking.with_context(
             skip_immediate=True, skip_backorder=True
         ).button_validate()
         self.shipping.action_assign()
         line = self.shipping.move_ids.move_line_ids
@@ -120,14 +120,48 @@
         self.assertFalse(
             backorder_ship.move_ids.move_orig_ids.filtered(
                 lambda m: m.state not in ("cancel", "done")
             )
         )
         self.assertTrue(
             all(m.procure_method == "make_to_order" for m in backorder_ship.move_ids)
+        )
+
+    def test_unrelease_backorder_when_canceled_picking(self):
+        """Check the unrelease of a shipping backorder move
+
+        The picking has been partially processed and the pick backorder has beeen canceled"""
+        self.picking.picking_type_id.create_backorder = "never"
+
+        line = self.picking.move_ids.move_line_ids
+        line.qty_done = line.reserved_qty - 1
+        self.picking.with_context(
+            skip_immediate=True, skip_backorder=True
+        ).button_validate()
+        self.shipping.action_assign()
+        line = self.shipping.move_ids.move_line_ids
+        line.qty_done = line.reserved_qty
+        self.shipping.with_context(
+            skip_immediate=True, skip_backorder=True
+        ).button_validate()
+        # at this stage, our backorder ship move is linked to the done pick move
+        backorder_ship = self.shipping.backorder_ids
+        backorder_pick = self._prev_picking(backorder_ship) - self.picking
+        self.assertEqual(len(backorder_pick), 0)
+        backorder_ship.move_ids.unrelease()
+        # after the un release, our backorder ship move is not more linked to
+        # a pick move to do
+        self.assertFalse(backorder_ship.move_ids.unrelease_allowed)
+        self.assertFalse(
+            backorder_ship.move_ids.move_orig_ids.filtered(
+                lambda m: m.state not in ("cancel", "done")
+            )
+        )
+        self.assertTrue(
+            all(m.procure_method == "make_to_order" for m in backorder_ship.move_ids)
         )
 
     def test_auto_unrelease_on_backorder(self):
         """Check that moves into a backorder are unreleased if specified on
         the picking type"""
         self.shipping.picking_type_id.unrelease_on_backorder = True
         # we do a partial pick and validate the picking to create a backorder
```

## Comparing `odoo_addon_stock_available_to_promise_release-16.0.3.1.0.6.dist-info/METADATA` & `odoo_addon_stock_available_to_promise_release-16.0.3.1.1.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: odoo-addon-stock-available-to-promise-release
-Version: 16.0.3.1.0.6
+Version: 16.0.3.1.1
 Summary: Release Operations based on available to promise
 Home-page: https://github.com/OCA/wms
 Author: Camptocamp, BCIM, Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: LGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
@@ -20,15 +20,15 @@
 ==================================
 
 .. 
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    !! This file is generated by oca-gen-addon-readme !!
    !! changes will be overwritten.                   !!
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-   !! source digest: sha256:7136991a96008e33746c0da827e727e20643070177bcc9979d3dfab83001a3d2
+   !! source digest: sha256:60c2c80681ea342a123d5e58c8fc019dfb706c4c0e440b8f034ef92790efbc2d
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 
 .. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
     :target: https://odoo-community.org/page/development-status
     :alt: Beta
 .. |badge2| image:: https://img.shields.io/badge/licence-LGPL--3-blue.png
     :target: http://www.gnu.org/licenses/lgpl-3.0-standalone.html
```

## Comparing `odoo_addon_stock_available_to_promise_release-16.0.3.1.0.6.dist-info/RECORD` & `odoo_addon_stock_available_to_promise_release-16.0.3.1.1.dist-info/RECORD`

 * *Files 2% similar despite different names*

```diff
@@ -1,51 +1,51 @@
-odoo/addons/stock_available_to_promise_release/README.rst,sha256=ni2qkI0Tl3Mzv61maCPb0wgLugXLASjVq8l9QqZ4WlA,7108
+odoo/addons/stock_available_to_promise_release/README.rst,sha256=RJPZIQ5r3-exuRoK4LbCk6584WA_sxGzcwx0lzXrN9o,7108
 odoo/addons/stock_available_to_promise_release/__init__.py,sha256=0G88xS6UBkVPseaKHRXqiWdKQICy8POD5brQM-nPyCg,76
-odoo/addons/stock_available_to_promise_release/__manifest__.py,sha256=n7te63YRV-TG5DsNhqagWigfw5ebwCzKNNGwGFl_4MM,996
+odoo/addons/stock_available_to_promise_release/__manifest__.py,sha256=RWrMazdmTJkmDeLDnDO5hdsgTI6m6vwhxGVhgz_6aiY,996
 odoo/addons/stock_available_to_promise_release/hooks.py,sha256=FPvmoZk6xtmpGiuPuAzDKlAA70CMSlKbIsWOHdnrEuU,829
 odoo/addons/stock_available_to_promise_release/i18n/es.po,sha256=S3s2HGr8XmLi0DUdKW_QKkanqwgVK2dJxiQEkxOGqOE,26676
 odoo/addons/stock_available_to_promise_release/i18n/es_AR.po,sha256=hnQWhmruDAMWRfkSP78059YRAiWqGlHYIPko9CJrSpI,25600
 odoo/addons/stock_available_to_promise_release/i18n/hr.po,sha256=klK-Ut0pkoMj8_lM9ThyXIyeO57bqHlBFwfGql3k3Ms,23617
 odoo/addons/stock_available_to_promise_release/i18n/it.po,sha256=20qB2FSGoAv4QCU7Ktv-grqDv18RPE8kEqT7phiuOs0,26601
 odoo/addons/stock_available_to_promise_release/i18n/stock_available_to_promise_release.pot,sha256=ntMF4Pe-o5Hv0xZvOIqi5FKkos4wnTcBqedxQAtbiKA,21778
 odoo/addons/stock_available_to_promise_release/migrations/16.0.2.0.0/post-migrate.py,sha256=4cZh_-42UwDozDn6RFoCFt7RV9Y0lgqJSAUwvxOu1uA,412
 odoo/addons/stock_available_to_promise_release/migrations/16.0.3.1.0/post-migrate.py,sha256=7nAp07z05qx9UDz7CEIquRXIWZ-IpwZCl56t0J-S1QQ,428
 odoo/addons/stock_available_to_promise_release/models/__init__.py,sha256=-CSTGtsxQ98AYBpTwUKq3bTUCJgH2oElFNsg2ICNbgk,256
 odoo/addons/stock_available_to_promise_release/models/product_product.py,sha256=bijVQAUrQijedgKjy8uNi-nIAUCYRE-S0hnVfewRkFQ,1085
 odoo/addons/stock_available_to_promise_release/models/res_company.py,sha256=dI7V3bVwGflDOf6VR6EEjKHxS2ocQEeei_Fflz6tDBQ,805
 odoo/addons/stock_available_to_promise_release/models/res_config_settings.py,sha256=9eJIIqr5fwIoVJs4sc6kZaPO8pbjRkI3mjsJXbPFv_g,520
 odoo/addons/stock_available_to_promise_release/models/stock_location.py,sha256=EP8PskejYwnnLpl5lzPtn-8TG49DMz3ETMGzZsUxl14,584
-odoo/addons/stock_available_to_promise_release/models/stock_move.py,sha256=LEUAlfnMVtHrOD0Aopc_8_FqzjimHif9eAK4tFFZ_nA,28754
+odoo/addons/stock_available_to_promise_release/models/stock_move.py,sha256=-tQ2kEAglO94VaW9vY5Q7ht0D-Q5Pwk1F133GznkaNE,29563
 odoo/addons/stock_available_to_promise_release/models/stock_picking.py,sha256=k-gUvmUuTzpHWHixxaT1wI4FCCZ7Te8DTRhXgZd6_Z4,7295
 odoo/addons/stock_available_to_promise_release/models/stock_picking_type.py,sha256=qcO-2At5EGIxmSNZJRrmn4BxWaS5Uzf0PyK_iMNF8HM,2904
 odoo/addons/stock_available_to_promise_release/models/stock_route.py,sha256=f6iRDYuki_Uk5I0ryqlb3z71xtAj_BJUgbxhKIWBAYY,788
 odoo/addons/stock_available_to_promise_release/models/stock_rule.py,sha256=le7OPXOA4qKV08F2mUb0BzsxDSrEGHfoa8sBEQU1QTo,2901
 odoo/addons/stock_available_to_promise_release/readme/CONFIGURE.rst,sha256=mHbRKM4EEAoatUNuyYJ05Hmv1qCXvpblFJuanrCuNvQ,240
 odoo/addons/stock_available_to_promise_release/readme/CONTRIBUTORS.rst,sha256=pc7r4o7c40rROIhBoiA_OU9CdGzamjsdoTVGHa2j5KM,264
 odoo/addons/stock_available_to_promise_release/readme/CREDITS.rst,sha256=qJic0c2qWDTloupuq6j69JdIEo70Xpy6-b4MZho00Og,80
 odoo/addons/stock_available_to_promise_release/readme/DESCRIPTION.rst,sha256=9tolVBrYsspt9IWKiN1qBvMzwBHDFDKzS97HAL7zgHs,2253
 odoo/addons/stock_available_to_promise_release/readme/USAGE.rst,sha256=X0GVvslcQfQqXJZzsO04eoJFrNfFNvtA9qwTEiBpd8U,1435
 odoo/addons/stock_available_to_promise_release/security/ir.model.access.csv,sha256=KAldr7h33qGLg6Pkc9r6g_jIx1JWCZErF0O7vp8LU_Y,297
 odoo/addons/stock_available_to_promise_release/static/description/icon.png,sha256=6xBPJauaFOF0KDHfHgQopSc28kKvxMaeoQFQWZtfZDo,9455
-odoo/addons/stock_available_to_promise_release/static/description/index.html,sha256=1kTcFh0BZNKjzxfnGxlqeGJ5PFsVjYp-ryPq1TpRfKM,17584
+odoo/addons/stock_available_to_promise_release/static/description/index.html,sha256=TsBJPyOECaGyb2QPz2FM2hKFGhdrnYz6SzKyG0WmVQY,17584
 odoo/addons/stock_available_to_promise_release/tests/__init__.py,sha256=hmVMoCt_AFhIZEY8ljHe1591DKObD4csAfKddsoeomA,174
 odoo/addons/stock_available_to_promise_release/tests/common.py,sha256=wrm2XpGEta2MBJWOdGyZwjl5FmP_LM3Fu33W7MR4d4I,4669
 odoo/addons/stock_available_to_promise_release/tests/test_reservation.py,sha256=4szLBeycg2j191ItJTvVeoIQs-6KEIXnYpnJgCJZq4k,50969
-odoo/addons/stock_available_to_promise_release/tests/test_unrelease.py,sha256=Y7sDWGueprk0MXOLoCcFdjFAYPlpjwQIVGyz71HErG0,6417
+odoo/addons/stock_available_to_promise_release/tests/test_unrelease.py,sha256=iO6WxELgcK5O_xggi3Yu6EA2NhGaIZjUs-AEvPnEyNQ,7940
 odoo/addons/stock_available_to_promise_release/tests/test_unrelease_2steps.py,sha256=ZAMfZZs3KfHK19bVdSxPv9RzvmFh28KzdsegAJ7nT0s,3354
 odoo/addons/stock_available_to_promise_release/tests/test_unrelease_3steps.py,sha256=CPdKTZbbbKYzPq1wGPw8Khzr1aBF_7Q1uq2IyYJgwiE,2842
 odoo/addons/stock_available_to_promise_release/tests/test_unrelease_merged_moves.py,sha256=CyX7GDMPKkvX60HA0anm_K21pxbxsoVD2rlFeo8i5qw,2103
 odoo/addons/stock_available_to_promise_release/views/product_product_views.xml,sha256=VSybBQm8SAvpLbBVWxk0W4omfZUzVR5W1oTKKFxKop8,1206
 odoo/addons/stock_available_to_promise_release/views/res_config_settings.xml,sha256=W6y5nUMGtquYMwRdw53Gy3hzOcb7Nt7PBvHrONDYwsA,2787
 odoo/addons/stock_available_to_promise_release/views/stock_move_views.xml,sha256=RUO70Y06CTy-vFOIBolv6D_BCDhn8ztAsxYaTaeSUCw,4606
 odoo/addons/stock_available_to_promise_release/views/stock_picking_type_views.xml,sha256=Om6uG9S-N06H67gvNeWQyjULwzYGV5pPihdC3Cf1t1s,1908
 odoo/addons/stock_available_to_promise_release/views/stock_picking_views.xml,sha256=N7JIK4sWaaqxAZpq6I4P1YVr9-KE_WiEYbEOmfYHzE4,6677
 odoo/addons/stock_available_to_promise_release/views/stock_route_views.xml,sha256=1PVJ1Cw_Db1Ez6-QAdct2Q1spReFIN2vPj08wgbmMK0,584
 odoo/addons/stock_available_to_promise_release/wizards/__init__.py,sha256=wu2Gdq1bgromFuK-i0Ezz8K6GZw7GnYKYKfeD8ceV08,58
 odoo/addons/stock_available_to_promise_release/wizards/stock_release.py,sha256=uhWdd747jF1Omr74NBUQhge4JyAiMvrQJvMO-sSyWfs,640
 odoo/addons/stock_available_to_promise_release/wizards/stock_release_views.xml,sha256=viqqxc488JH0RzkI4i3kjX9IatCwOUDE8-iqbrBZWss,1856
 odoo/addons/stock_available_to_promise_release/wizards/stock_unrelease.py,sha256=TV15Vid4NET7q0skXC8DZPM4tH9kV2jShWi5HrF5BXg,646
 odoo/addons/stock_available_to_promise_release/wizards/stock_unrelease_views.xml,sha256=e6nJ3dPibK6GLQfsWal-nWHqtTAGI-XXf33L0hZRlPA,1888
-odoo_addon_stock_available_to_promise_release-16.0.3.1.0.6.dist-info/METADATA,sha256=6vBaZQmr_3aYK-d80LAVmrZfKJDBdghG8QWSijFyQrM,7737
-odoo_addon_stock_available_to_promise_release-16.0.3.1.0.6.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
-odoo_addon_stock_available_to_promise_release-16.0.3.1.0.6.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo_addon_stock_available_to_promise_release-16.0.3.1.0.6.dist-info/RECORD,,
+odoo_addon_stock_available_to_promise_release-16.0.3.1.1.dist-info/METADATA,sha256=PaF-9QTUvkHeZIgLrxRUXlla3csBU3aa_yhYXBD4xfs,7735
+odoo_addon_stock_available_to_promise_release-16.0.3.1.1.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+odoo_addon_stock_available_to_promise_release-16.0.3.1.1.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo_addon_stock_available_to_promise_release-16.0.3.1.1.dist-info/RECORD,,
```

